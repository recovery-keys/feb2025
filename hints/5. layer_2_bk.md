# Layer 2 Backups (version 5) - hints & steps

##  NOTE!!
- To reduce the complexcity of the backup process, a snapshot backup is generated.
- Using `gpg` and `LUKS` for encryption.


### Step 1. Create ZIP file:
- Select the folders and create a `ZIP` archive with format: `l2_bkv5_DD_MMM_YYYY.zip`.

### Step 2. Encrypt the ZIP file:
- Encrypt the compressed file using password generated by the `password_hash_gen v1.0.0`.
- Hash `256 hash` with `5 iterations` of above combination.
#### combination:
Hash Iterations | Question 1 | Question 2 | File 1 | File 2 |
--- | --- | --- |--- |--- |
sha256(x5) | q76(txt)  | q90(txt) | q77(img) | q59(key) |
```
$ gpg -c <file>
```
### Step 3. Create IMG container:
- Create a disk image (*.img) using Linux disk utils & mount. (350MB or more).

### Step 4. Create IMG container:
- Format the newly created image to a LUKS container using below combination:
- Encrypt the compressed file using password generated by the `password_hash_gen v1.0.0`.
- Hash `256 hash` with `5 iterations` of above combination.

#### Step 4.1. Steps to create LUKS Partition
1. Creakte LUKS Partition by alocating space.
```
dd if=/dev/zero of=/media/USER/l2_bkv5_dd_mmm_yyyy.img bs=1M count=400
```

2. Format the file and encrypt it with LUKS:
```
cryptsetup -vy luksFormat /media/USER/l2_bkv5_dd_mmm_yyyy.img
```

3. Open the new encrypted container:
```
sudo cryptsetup luksOpen /media/USER/l2_bkv5_dd_mmm_yyyy.img bk_l2
```

4. Format the encrypted container:
```
sudo mkfs.ext4 /dev/mapper/bk_l2
```

5. Mount the container:
```
sudo mount /dev/mapper/bk_l2 /media/l2_bk
```
6. Grant write Permissons:
```
sudo chmod 777 /media/l2_bk
```
[Read More](https://shaakunthala.wordpress.com/2017/11/27/how-to-create-an-encrypted-luks-disk-image/)

#### combination:
Hash Iterations | Question 1 | Question 2 | File 1 | File 2 |
--- | --- | --- |--- |--- |
sha256(x5) | q43(txt)  | q47(txt) | q66(img) | q34(key) |

- Copy the encrypted ZIP file to the mounted location.
- Dismount the image.
- Rename the image file with below format:
`l2_bkv5_DD_MMM_YYYY.img`
- Upload the final image to `Cold Storage` & `Cloud`.


#### Unmounting the container:
```
sudo umount /dev/mapper/bk_l2
```
```
sudo cryptsetup close /dev/mapper/bk_l2
```